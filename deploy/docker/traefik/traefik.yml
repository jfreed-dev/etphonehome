# =============================================================================
# Reach - Traefik Static Configuration
# =============================================================================

# API and Dashboard
api:
  dashboard: true
  insecure: false  # Dashboard behind authentication

# Logging
log:
  level: INFO
  format: json

accessLog:
  format: json
  filters:
    statusCodes:
      - "400-599"  # Only log errors
    retryAttempts: true
    minDuration: "100ms"

# Entry Points
entryPoints:
  # HTTP on port 80 - redirects to HTTPS
  web:
    address: ":80"
    http:
      redirections:
        entryPoint:
          to: websecure
          scheme: https
          permanent: true
  # HTTPS on 8443 (port 443 reserved for SSH client tunnels)
  websecure:
    address: ":8443"
    http:
      tls:
        certResolver: cloudflare
    http2:
      maxConcurrentStreams: 250
  # Internal ping endpoint for healthchecks
  ping:
    address: ":8082"

# Providers
providers:
  # Using file provider instead of Docker provider to avoid API version issues
  # Docker provider disabled due to Docker API v1.44+ requirement
  # docker:
  #   endpoint: "unix:///var/run/docker.sock"
  #   exposedByDefault: false
  #   network: proxy
  #   watch: true

  # Dynamic file provider for routing and middleware configuration
  file:
    directory: /etc/traefik/dynamic
    watch: true

# Certificate Resolvers
certificatesResolvers:
  cloudflare:
    acme:
      # Email for Let's Encrypt account
      email: "jon@freed.dev"
      # Storage file for certificates
      storage: /letsencrypt/acme.json
      # DNS-01 challenge using Cloudflare
      dnsChallenge:
        provider: cloudflare
        # Delay before checking DNS propagation
        delayBeforeCheck: 10s
        # DNS resolvers for verification
        resolvers:
          - "1.1.1.1:53"
          - "8.8.8.8:53"

# Ping endpoint for health checks (on dedicated internal port)
ping:
  entryPoint: ping
