# Reach Server Deployment Playbook
#
# Usage:
#   ansible-playbook -i inventory.yml deploy-server.yml
#
---
- name: Deploy Reach Server
  hosts: reach_servers
  gather_facts: true

  pre_tasks:
    - name: Verify target is Debian-based
      ansible.builtin.assert:
        that:
          - ansible_os_family == "Debian"
        fail_msg: "This playbook currently only supports Debian-based systems"
        success_msg: "Target OS verified: {{ ansible_distribution }} {{ ansible_distribution_version }}"

  roles:
    - role: reach-server

  post_tasks:
    - name: Display server status
      ansible.builtin.debug:
        msg: |
          Reach Server deployed successfully!

          SSH Port: {{ reach_ssh_port }}
          HTTP Port: {{ reach_http_port }}

          Next steps:
          1. Add client public keys to {{ reach_home }}/.ssh/authorized_keys
          2. Configure Claude Code to use the MCP server
